//******************************************************************************
// delay.c                                                                     *
//******************************************************************************
// Delay functions for STM8 at 16 MHz.                                         *
// By Ed Smallenburg.                                                          *
//******************************************************************************
// History:                                                                    *
// 09-10-2018, ES: First set-up.                                               *
// 27-03-2019, ES: Version for stoflamp software.                              *
//******************************************************************************
#include "delay.h"

//******************************************************************************
//                    D E L A Y _ C Y C L                                      *
//******************************************************************************
// Delay for "ticks" * 4 cycles.                                               *
//******************************************************************************
void delay_cycl ( uint16_t ticks )
{
	// ldw X, ticks ; insert automaticaly
	_asm ( "$N:\n decw X\n jrne $L\n" ) ;     // 4 cycle loop
}


//******************************************************************************
//                    D E L A Y _ U S                                          *
//******************************************************************************
// Delay for "us" microseconds. "us" must be in the range 0..10000.            *
//******************************************************************************
void delay_us ( uint16_t us )
{
  delay_cycl ( us * 5 ) ;
}


//******************************************************************************
//                    D E L A Y _ M S                                          *
//******************************************************************************
// Delay for "ticks" milliseconds.                                             *
//******************************************************************************
void delay_ms( uint16_t ms )
{
	while ( ms-- )                          // Wait until zero count
  {
    delay_us ( 1000 ) ;                   // Wait for interrupts
  }
}